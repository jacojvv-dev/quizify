var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.quizify=t()}(this,function(){"use strict";var a=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"QuizDataRequiredException",value:function(){return new Error("QuizDataRequiredException: The quiz data is required.")}},{key:"QuizDataInvalidType",value:function(e){return new Error("QuizDataInvalidType: The quiz data type "+e+" is invalid. The type should be of array.")}},{key:"QuizDataInvalidException",value:function(){return new Error("QuizDataInvalidException: The quiz data is invalid.")}},{key:"QuizQuestionDataRequiredException",value:function(e){var t=JSON.stringify(e);return new Error("QuizQuestionDataRequiredException: Quiz question is missing required data.\nProvided: "+t)}},{key:"QuizAnswerDataRequiredException",value:function(e){var t=JSON.stringify(e);return new Error("QuizAnswerDataRequiredException: Quiz answer is missing required data.\nProvided: "+t)}},{key:"QuizQuestionAnswerRequired",value:function(){return new Error("QuizQuestionAnswerRequired: The answer to the current question is required.")}},{key:"QuizNoAnswerSelectedException",value:function(){return new Error("QuizNoAnswerSelectedException: The user has not selected an answer for the question.")}}]),e}(),l=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"IsEmpty",value:function(e){return 0===Object.keys(e).length&&e.constructor===Object||e.length<=0}},{key:"GetObjectProperties",value:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}},{key:"CheckAllValuesExistInArray",value:function(e,t){for(var n=0;n<t.length;n++)if(-1===e.indexOf(t[n]))return!1;return!0}},{key:"ShuffleArray",value:function(e){return e.map(function(e){return[Math.random(),e]}).sort(function(e,t){return e[0]-t[0]}).map(function(e){return e[1]})}}]),e}(),_=function(){function s(){_classCallCheck(this,s)}return _createClass(s,null,[{key:"CreateElement",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=document.createElement(e);return n&&(void 0===n?"undefined":_typeof(n))===_typeof("")&&0<n.length&&(t=r.classList).add.apply(t,_toConsumableArray(n.split(" "))),i&&(void 0===i?"undefined":_typeof(i))===_typeof("")&&0<i.length&&s.SetText(r,i),r}},{key:"SetText",value:function(e,t){e.innerText=t}},{key:"AddChild",value:function(e,t){e.appendChild(t)}}]),s}(),i={shuffle:!0,shuffleAnswers:!0,limitQuestionsTo:null,questionContainerClass:"quizify-question-container",answerListClass:"quizify-answer-list",answerListItemClass:"quizify-answer-list-item",questionNextButtonClass:"quizify-button-next"},u=["id","content","weight","answers","answer_limit"],c=["id","content","is_correct"],r=function e(t){_classCallCheck(this,e),this.type="question",this.data=t},s=function e(t){_classCallCheck(this,e),this.type="result",this.data=t},t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"AnswerSelected",value:function(){return new CustomEvent("answerSelected",{detail:null,bubbles:!0,cancelable:!0})}}]),e}();function e(){}_extends(e.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t)for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e)}}});var n=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,n),this._options=_extends(JSON.parse(JSON.stringify(i)),t),this._position=-1,this._validateData(e),this._setup(e)}return _createClass(n,[{key:"_validateData",value:function(e){if(!e)throw new a.QuizDataRequiredException;if((void 0===e?"undefined":_typeof(e))!=_typeof([]))throw new a.QuizDataInvalidType(void 0===e?"undefined":_typeof(e));if(l.IsEmpty(e))throw new a.QuizDataInvalidException;for(var t=0;t<e.length;t++){var n=e[t],i=l.GetObjectProperties(n);if(!l.CheckAllValuesExistInArray(i,u))throw new a.QuizQuestionDataRequiredException(n);for(var r=0;r<n.answers.length;r++){var s=n.answers[r],o=l.GetObjectProperties(s);if(!l.CheckAllValuesExistInArray(o,c))throw new a.QuizAnswerDataRequiredException(s)}}}},{key:"_setup",value:function(e){for(var t=0;t<e.length;t++){var n=e[t].answers.filter(function(e){return!0===e.is_correct}),i=l.ShuffleArray(e[t].answers.filter(function(e){return!1===e.is_correct}));if(null!==e[t].answer_limit){if(e[t].answer_limit<=n.length||e[t].answer_limit>e[t].answers.length)continue;e[t].answers=n.concat(i.slice(0,e[t].answer_limit-n.length))}}var r=this._options,s=r.shuffle,o=r.shuffleAnswers,a=r.limitQuestionsTo;if(!0===s&&(e=l.ShuffleArray(e)),!0===o)for(var u=0;u<e.length;u++)e[u].answers=l.ShuffleArray(e[u].answers);null===a||isNaN(a)||(e=e.slice(0,a)),this._data=e}},{key:"_constructQuestionDOMNode",value:function(e){var t=this,n=this._options,i=n.questionContainerClass,r=n.answerListClass,s=n.answerListItemClass,o=n.questionNextButtonClass,a=_.CreateElement("div",i),u=_.CreateElement("p",null,e.content);_.AddChild(a,u);for(var l=_.CreateElement("ul",r),c=0;c<e.answers.length;c++){var d=e.answers[c],f=_.CreateElement("li",s),h=!0===e.has_multiple_answers?"checkbox":"radio",p=_.CreateElement("input");p.type=h,p.name="quizify_answer_option",p.value=d.id,_.AddChild(f,p);var v=_.CreateElement("span",null," "+d.content);_.AddChild(f,v),_.AddChild(l,f)}_.AddChild(a,l);var y=_.CreateElement("button",o,"Next Question");return y.addEventListener("click",function(){t._processDOMResult.call(t)}),_.AddChild(a,y),a}},{key:"_processDOMResult",value:function(){for(var e=0<document.querySelectorAll("input[name=quizify_answer_option]:checked").length?document.querySelectorAll("input[name=quizify_answer_option]:checked"):document.querySelectorAll("input[name=quizify_answer_option]"),t=[],n=0;n<e.length;n++)!0===e[n].checked&&t.push(e[n].value);if(t.length<=0)throw new a.QuizNoAnswerSelectedException;this.processUserAnswer(t)}},{key:"_constructResultsDOMNode",value:function(e){var t=_.CreateElement("div",this._options.questionContainerClass),n=_.CreateElement("h2",null,"Quiz Results");_.AddChild(t,n);var i=e.totalAchievedScore,r=e.totalPossibleScore,s=e.percentageAchieved,o=_.CreateElement("p",null,"You got "+i+" out of "+r+" ("+s+"%)");return _.AddChild(t,o),e.dom_node=t,e}},{key:"_gradeQuestions",value:function(){for(var e,t=0,n=0,i=0,r=0;r<this._data.length;r++){var s=this._data[r];t+=s.weight;for(var o=0,a=0,u=0;u<s.answers.length;u++){var l=s.answers[u];l.is_correct&&-1!==s._selectedAnswers.indexOf(l.id.toString())?o+=s.weight/s.answers.filter(function(e){return!0===e.is_correct}).length:s.has_multiple_answers&&!l.is_correct&&-1!==s._selectedAnswers.indexOf(l.id.toString())&&(a+=s.weight/s.answers.filter(function(e){return!0===e.is_correct}).length)}a<=o&&(n+=o,i+=a)}var c={totalPossibleScore:t,totalAchievedScore:n,totalPenalisedScore:i,totalFinalScore:e=n-i,percentageAchieved:Math.round(e/t*100),dom_node:null};return this._constructResultsDOMNode(c)}},{key:"processUserAnswer",value:function(e){if(e.length<=0)throw new a.QuizNoAnswerSelectedException;this._data[this._position]._selectedAnswers=e,this.dispatchEvent(t.AnswerSelected())}},{key:"getNext",value:function(){if(-1<this._position&&!this._data[this._position]._selectedAnswers)throw new a.QuizNoAnswerSelectedException;this._position++;var e=this._data[this._position];if(e){var t=e.answers.filter(function(e){return!0===e.is_correct}).length;return e.has_multiple_answers=1!==t,e.dom_node=this._constructQuestionDOMNode(e),new r(e)}var n=this._gradeQuestions();return new s(n)}}]),n}();return _extends(n.prototype,e.prototype),n});